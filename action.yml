name: 'Cloudways SSH Authentication'
description: 'Github action to setup SSH key to perform task via SSH session'
inputs:
  email:
    description: 'Cloudways account email'
    required: true
  api_key:
    description: 'Cloudways API key'
    required: true
  task_id:
    description: 'Task ID generated by /auth endpoint'
    required: true

runs:
  using: "composite"
  steps:
    - name: Set GitHub Path
      run: echo "$GITHUB_ACTION_PATH" >> $GITHUB_PATH
      shell: bash
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}
    
    - name: Run auth_cleanup.sh
      id: auth-cleanup
      if: steps.setup_ssh.outputs.task-id != ''
      run: auth_cleanup.sh
      shell: bash
      env:
        EMAIL: ${{ inputs.email }}
        API_KEY: ${{ inputs.api_key }}
        TASK_ID: ${{ inputs.api_key }}
